create function tcu.fn_ProcessSchedule_NextId
(	@processId	smallint	)
returns tinyint
as
/*
????????????????????????????????????????????????????????????????????????????????
			c 2000-08 ? Texans Credit Union ? All rights reserved.
????????????????????????????????????????????????????????????????????????????????
Developer:	Paul Hunter
Created  :	10/30/2007
Purpose  :	Returns the next available Process Id for the Process table filling
			in any gaps in the sequence.
History	 :
   Date		Developer		Description
??????????	??????????????	????????????????????????????????????????????????????
????????????????????????????????????????????????????????????????????????????????
*/
begin
	declare @nextId tinyint
	select	top 1
			@nextId	= min(ScheduleId) + 1
	from	tcu.ProcessSchedule
	where	ProcessId	= @processId
	and		ScheduleId	not in ( select ScheduleId - 1 from tcu.ProcessSchedule where ProcessId	= @processId)
	return	isnull(@nextId, 1)
end
GO
