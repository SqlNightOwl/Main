create function tcu.fn_Frequency
(	@frequencyId int	)
returns varchar(100)
as
/*
????????????????????????????????????????????????????????????????????????????????
			c 2000-08 ? Texans Credit Union ? All rights reserved.
????????????????????????????????????????????????????????????????????????????????
Developer:	Paul Hunter
Created  :	05/30/2008
Purpose  :	Returns a standard string for the frequencies from the bitmask value.
History  :
   Date		Developer		Description
??????????	??????????????	????????????????????????????????????????????????????
????????????????????????????????????????????????????????????????????????????????
*/
begin
	declare @return	varchar(100)
	set	@return		= ''

	--	handle pre-defined frequencies
	select	@return		= Frequency
	from	tcu.Frequency
	where	FrequencyId	= @frequencyId
	and		Sequence	= 99

	--	this is a custom frequency...
	if len(@return) = 0
	begin
		--	collect the possible values
		select	@return = @return + Frequency + ' & '
		from	tcu.Frequency
		where	FrequencyId	= FrequencyId & @frequencyId
		and		Sequence	not between 11 and 15
		and		Sequence	< 99
		order by Sequence
		--	clean up the return string...
		if right(@return, 3) = ' & '
			set @return = left(@return, len(@return) - 2)
		--	insert the frequencies into the "# N Day of the Month" periodic value
		select	@return	= replace(Frequency, 'N day', @return)
		from	tcu.Frequency
		where	FrequencyId	= FrequencyId & @frequencyId
		and		Sequence	between 11 and 15
		order by Sequence
	end
	--	you're done!
	return	@return
end
GO
