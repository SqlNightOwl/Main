create function tcu.fn_Process_NextId( @ProcessType char(3) = null )
returns smallint
as
/*
????????????????????????????????????????????????????????????????????????????????
			c 2000-09 ? Texans Credit Union ? All rights reserved.
????????????????????????????????????????????????????????????????????????????????
Developer:	Paul Hunter
Created  :	10/30/2007
Purpose  :	Returns the next available Process Id for the Process table filling
			in any gaps in the sequence.
History	 :
   Date		Developer		Description
??????????	??????????????	????????????????????????????????????????????????????
10/09/2009	Paul Hunter		Added ability to create new number within a Process
							Type range.
????????????????????????????????????????????????????????????????????????????????
*/
begin
	declare @nextId smallint;
	select	top 1
			@nextId	= min(ProcessId) + 1
	from	tcu.Process
	where	ProcessId		not in ( select ProcessId - 1 from tcu.Process )
	and	(	ProcessType		= @ProcessType
		or	@ProcessType	is null );
	return	isnull(@nextId, 1);
end;
GO
