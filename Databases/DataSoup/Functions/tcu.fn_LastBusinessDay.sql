create function tcu.fn_LastBusinessDay
(	@dateValue	datetime	)
returns datetime
as
/*
????????????????????????????????????????????????????????????????????????????????
			c 2000-07 ? Texans Credit Union ? All rights reserved.
????????????????????????????????????????????????????????????????????????????????
Developer:	Paul Hunter
Created  :	11/20/2005
Purpose  :	Retruns the last business day of the month for the date value provided.
History	 :
   Date		Developer		Description
??????????	??????????????	????????????????????????????????????????????????????
????????????????????????????????????????????????????????????????????????????????
*/
begin
	-- get the last day of the month for the specified date
	set	@dateValue = isnull(@dateValue, getdate())
	set	@dateValue = convert(char(10), dateadd(day, -1, dateadd(month, 1, dateadd(day, -datepart(day, @dateValue) + 1, @dateValue))), 101)
	while datepart(weekday, @dateValue) in (1, 7) -- sunday, saturday
	begin
		set	@dateValue = dateadd(day, -1, @dateValue)	
	end
	return @dateValue
end
GO
